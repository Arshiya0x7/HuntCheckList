# üïµÔ∏è Multi-Brand / Multi-Tenant Pentest Checklist

This document provides a structured methodology for penetration testing **multi-brand** or **multi-tenant** web applications.  
Focus: **isolation**, **configuration switching risks**, **cross-tenant privilege escalation**, and **business logic flaws**.

---

## 1. Recon & Discovery
| Test | Description | Notes |
|------|-------------|-------|
| Source Maps & Bundles | Extract `.js.map` / frontend bundles for config leaks | Look for API URLs, env configs, brand identifiers |
| Brand Enumeration | Identify all supported brands/domains | Example: `gamma.nl`, `karwei.nl`, `gamma.be` |
| Environment Discovery | Check for staging/dev/acceptance environments | Subdomain brute force (`uat.`, `acc.`, `staging.`) |

---

## 2. Config Switching Risks
| Test | Description | Notes |
|------|-------------|-------|
| Param Switching | Force `?brand=gamma&country=BE` on another brand | See if backend accepts |
| Host Header Injection | Test `gamma.nl.evil.com` or `gamma.evil.com` | If frontend logic switches config ‚Üí poisoning risk |
| Formula Config Override | Manually change `formulaConfig` in requests | Look for cross-brand functionality |

---

## 3. Authentication & Session Isolation
| Test | Description | Notes |
|------|-------------|-------|
| Cookie/Session Reuse | Use `gamma.nl` session cookie on `karwei.nl` | Check isolation |
| JWT Claims | Inspect if token has brand/country | Try tampering |
| Cross-Brand Login | Attempt login on brand B with brand A credentials | Misconfigured SSO = high risk |

---

## 4. Authorization & Access Control
| Test | Description | Notes |
|------|-------------|-------|
| Cross-Tenant IDOR | Access `/api/karwei/orders/1234` with `gamma` session | Sensitive data leak |
| Brand-Specific Role Escalation | Modify `brand` in request/JWT | Can user escalate privileges across tenants? |

---

## 5. Payment & Checkout Manipulation
| Test | Description | Notes |
|------|-------------|-------|
| Cross-Checkout | Add product from `gamma` in `karwei` checkout | Inconsistent validation |
| Price Confusion | Test locale-based price parsing | `,` vs `.` separators |
| VAT/Tax Manipulation | Switch brand mid-checkout | Country mismatch may bypass validation |

---

## 6. Locale & Language Switching
| Test | Description | Notes |
|------|-------------|-------|
| Unsupported Locales | `?locale=xx_XX` | Error disclosure or fallback issues |
| Sensitive Data in Errors | Check stack traces on unsupported locales | Info disclosure |

---

## 7. API Gateway & CORS
| Test | Description | Notes |
|------|-------------|-------|
| AllowedTracingUrls Override | Try redirecting API calls to attacker endpoint | SSRF-like potential |
| CORS Misconfig | Can brand A frontend call brand B API? | Cross-origin leakage |

---

## 8. Session Replay & Analytics
| Test | Description | Notes |
|------|-------------|-------|
| Datadog RUM Leakage | Confirm sensitive fields (passwords, CCs) aren‚Äôt tracked | Config shows full session replay |
| Staging Envs | Check if acceptance/staging send data to production RUM | Data exposure |

---

## 9. Caching & CDN
| Test | Description | Notes |
|------|-------------|-------|
| Shared Cache | Rapidly switch between brands, compare responses | Cross-tenant leakage |
| Vary Header | Check if CDN varies on `Host` | Misconfig may share cache |

---

## 10. Feature Flags & Business Logic
| Test | Description | Notes |
|------|-------------|-------|
| Hidden Features | Try params like `giftCard=true` on brands without support | Business logic bypass |
| Brand-Restricted Features | Call API from brand B with brand A features | Unauthorized access |

---

## 11. Deployment & Legacy Endpoints
| Test | Description | Notes |
|------|-------------|-------|
| Old APIs | Check `/api-dev/`, `/acc/api/`, `/staging/checkout` | Forgotten endpoints |
| Config Drift | Test if old endpoints still accept production tokens | Weak isolation |

---

## 12. Edge-Case Attacks
| Test | Description | Notes |
|------|-------------|-------|
| Rate Limiting | Compare brand A vs brand B | Different throttling policies |
| Password Policies | Test brand A vs brand B | Drift may allow weak accounts |
| Tracking Pixel | Check cross-brand analytics | Data leakage |

---

## üìå Reporting
- Group findings into categories:  
  - **Config Switching Risk**  
  - **Cross-Tenant Access**  
  - **Privilege Escalation**  
  - **Payment Manipulation**  
  - **Info Disclosure**  

Each confirmed issue should be validated in multiple brands to prove **systemic risk**.

---

‚úÖ **Feel free to submit PRs with new test cases or examples from real-world assessments.**
